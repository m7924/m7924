<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1" >
<meta name="renderer" content="webkit">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="format-detection" content="telephone=no" />
<title>标题</title>
<meta name="keywords" content="关键词" />
<meta name="description" content="描述" />
<link href="css/css.css" rel="stylesheet" type="text/css" />
<link href="css/media.css" rel="stylesheet" type="text/css" />
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

</head>
<body>
<div class="loading">
	<span class="loadingfa xuanzhuan"><img src="images/loading.png" alt=""></span>
</div>
<input id="J_code" type="hidden" value="b2ab4aae69774ca4a5831e256ea9807a">


<div class="topMenu">
  <div class="logo">
  	<a href="#">
  		<span class="title"><img src="images/logo.png" alt=""></span>
  		<span class="cn">时千华可视化智慧工地综合管理平台</span>
  	</a>
  </div>
  <div class="switch"></div>
  <div class="right">
  	<div class="infor">
  		<h2 class="h2tit">
  			<img src="images/user.png" alt="">
  			<span>陈海杰</span>
  		</h2>
  	</div>
  	<div class="link">
  		<a href="#" class="icon1">短信息（0）</a>
  		<a href="#" class="icon2">账号设置</a>
  		<a href="#" class="icon3">安全退出</a>
  	</div>
  </div>
</div>

<div class="topInfor">
	<div class="left">欢迎来到XXX（厦门）科技有限公司可视化智慧工地综合管理平台</div>
	<div class="right">
		今天是：<span class="day"></span> 
		农历：<span class="nl"></span>
	</div>
</div>



<div class="main">
	<div class="leftSwitch"></div>
	<div class="leftMenu">
		<div class="items">
			<div class="item">
				<h2 class="h2tit">
					<a href="javascript:;">工作台</a>
				</h2>
				<dl>
					<dd>
						<a href="#">
							项目情况
						</a>
					</dd>
					<dd>

						<a href="#">数据看板</a>
					</dd>
				</dl>
			</div>
			<div class="item current">
				<h2 class="h2tit">
					<a href="javascript:;">视频监控</a>
				</h2>
				<dl style="display: block;">
					<dd><a href="#" class="cur">省厅远程监控</a></dd>
					<dd><a href="#">项目监控</a></dd>
					<dd><a href="#">AR监控</a></dd>
					<dd><a href="#">录像回放</a></dd>
				</dl>
			</div>
			<div class="item">
				<h2 class="h2tit">
					<a href="javascript:;">劳务管理</a>
				</h2>
				<dl>
					<dd><a href="#">班组信息</a></dd>
					<dd><a href="#">人员管理</a></dd>
					<dd><a href="#">参建单位</a></dd>
					<dd><a href="#">疫情防控</a></dd>
					<dd><a href="#">工资管理</a></dd>
					<dd><a href="#">报表统计</a></dd>
				</dl>
			</div>
			<div class="item">
				<h2 class="h2tit">
					<a href="javascript:;">质量管理</a>
				</h2>
				<dl>
					<dd>
						<a href="#">工地巡检</a>
					</dd>
				</dl>
			</div>
			<div class="item">
				<h2 class="h2tit">
					<a href="javascript:;">绿色施工</a>
				</h2>
				<dl>
					<dd>
						<a href="#">扬尘监测</a>
					</dd>
					<dd>
						<a href="#">喷淋联动</a>
					</dd>
					<dd>
						<a href="#">渣土车管理</a>
					</dd>
				</dl>
			</div>
			<div class="item">
				<h2 class="h2tit">
					<a href="javascript:;">高危监管</a>
				</h2>
				<dl>
					<dd>
						<a href="#">
							塔基监测
						</a>
					</dd>
					<dd>
						<a href="#">
							升降机监测
						</a>
					</dd>
					<dd>
						<a href="#">
							深基坑监测
						</a>
					</dd>
					<dd>
						<a href="#">
							高支模监测
						</a>
					</dd>
					<dd>
						<a href="#">
							脚手架监测
						</a>
					</dd>
				</dl>
			</div>
			<div class="item">
				<h2 class="h2tit">
					<a href="javascript:;">能耗管理</a>
				</h2>
				<dl>
					<dd>
						<a href="#">
							智能用电管理
						</a>
					</dd>
					<dd>
						<a href="#">
							智能用水检测
						</a>
					</dd>
				</dl>
			</div>
			<div class="item">
				<h2 class="h2tit">
					<a href="javascript:;">安全施工</a>
				</h2>
				<dl>
					<dd>
						<a href="#">
							车辆进出管理
						</a>
					</dd>
					<dd>
						<a href="#">
							工地会议
						</a>
					</dd>
					<dd>
						<a href="#">
							无人机值守
						</a>
					</dd>
					<dd>
						<a href="#">
							智能地磅
						</a>
					</dd>
					<dd>
						<a href="#">
							卸料平台监测
						</a>
					</dd>
					<dd>
						<a href="#">
							防护栏安全
						</a>
					</dd>
					<dd>
						<a href="#">
							人员定位
						</a>
					</dd>
				</dl>
			</div>
			<div class="item">
				<h2 class="h2tit">
					<a href="javascript:;">智慧桥隧</a>
				</h2>
				<dl>
					<dd>
						<a href="#">
							智能广播
						</a>
					</dd>
					<dd>
						<a href="#">
							应急电话
						</a>
					</dd>
					<dd>
						<a href="#">
							气体监测
						</a>
					</dd>
					<dd>
						<a href="#">
							声光报警
						</a>
					</dd>
					<dd>
						<a href="#">
							VR安全教育
						</a>
					</dd>
					<dd>
						<a href="#">
							党建
						</a>
					</dd>
				</dl>
			</div>
			<div class="item">
				<h2 class="h2tit">
					<a href="javascript:;">BIM应用</a>
				</h2>
				<dl>
					<dd><a href="#">BIM导入</a></dd>
				</dl>
			</div>
			<div class="item">
				<h2 class="h2tit">
					<a href="javascript:;">运维中心</a>
				</h2>
				<dl>
					<dd>
						<a href="#">
							项目工作台
						</a>
					</dd>
					<dd>
						<a href="#">
							设备运维
						</a>
					</dd>
					<dd>
						<a href="#">
							报修中心
						</a>
					</dd>
					<dd>
						<a href="#">
							进度与回执
						</a>
					</dd>
					<dd>
						<a href="#">
							问题交流平台
						</a>
					</dd>
				</dl>
			</div>
		</div>
	</div>
	<div class="rightContent">
		<div class="controlsBtn">
			<ul>
				<li>
					<h2 class="h2tit">
						<a href="#">项目看板</a>
					</h2>
				</li>
				<li class="add">
					<h2 class="h2tit">
						<a href="#">添加视频</a>
						<i class="wap"></i>
					</h2>
					<dl>
						<dd>
							<a href="#">
								接入协议
							</a>
						</dd>
						<dd>
							<a href="#">
								添加监控点
							</a>
						</dd>
					</dl>
				</li>
				<li>
					<h2 class="h2tit">
						<a href="#">视频管理</a>
					</h2>
				</li>
				<li>
					<h2 class="h2tit">
						<a href="#">监控点运维</a>
					</h2>
				</li>
				<li>
					<h2 class="h2tit">
						<a href="#">上传监控系统</a>
					</h2>
				</li>
			</ul>
		</div>

		<div class="detailContent">
			<div class="videoList">

				<iframe id="iframe1" class="iframe" src="/initPlugin" scrolling="no" frameborder="0"  width="95%" height="95%"></iframe>

			</div>
			<div class="videoInforControls">
				<h2 class="h2tit"><span>云台</span></h2>
				<div class="controlsMent">
					<div class="controls">
						<i class="min">MIN</i>
						<i class="max">MAX</i>
						<div class="btns">
							<div class="center"></div>
							<div class="left"></div>
							<div class="right"></div>
							<div class="top"></div>
							<div class="bottom"></div>
						</div>
					</div>
					<div class="textInfor">
						<ul>
							<li>
								<div class="title">聚焦</div>
								<div class="pr">
									<i>+</i>
									<i>-</i>
								</div>
							</li>
							<li>
								<div class="title">倍率</div>
								<div class="pr">
									<i>+</i>
									<i>-</i>
								</div>
								<div class="lock"></div>
								<!-- <div class="lock locked"></div> -->
							</li>
						</ul>
					</div>
				</div>
				<div class="pointList">
					<h3 class="h3tit">监控点</h3>
					<div class="list">
						<ul>
							<li>
								<div class="title">
									<img src="images/site1.png" alt="">
									<span>时千华建筑（4/7）</span>
								</div>
								<div class="slide">
									<div class="item">
										<h4 class="h4tit">
											<img src="images/site2.png" alt="">
											<span>集美污水处理厂（3/5）</span>
										</h4>
										<dl>
											<dd>
												<a href="javascript:playBtn('acf3949ff95c406c8f8d0df57d3f5d09');"  id="b2ab4aae69774ca4a5831e256ea9807a">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="javascript:playBtn('c7521d66bf42479a962faa5b30d2b827');"  id="c7521d66bf42479a962faa5b30d2b827">市教育科学研究院附属中小学大门</a>
											</dd>
											<dd>
												<a href="javascript:playBtn('066db26ae4ea43d4bb6e07284f63e56f');"  id="066db26ae4ea43d4bb6e07284f63e56f">施工升降梯</a>
											</dd>
											<dd>
												<a href="javascript:playBtn('5c7c66e01512456fa67ce08174a6844c');"  id="5c7c66e01512456fa67ce08174a6844c">大门口高清摄像机</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
										</dl>
									</div>
									<div class="item">
										<h4 class="h4tit">
											<img src="images/site2.png" alt="">
											<span>集美污水处理厂（3/5）</span>
										</h4>
										<dl>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
										</dl>
									</div>
									
									<div class="item">
										<h4 class="h4tit">
											<img src="images/site2.png" alt="">
											<span>集美污水处理厂（3/5）</span>
										</h4>
										<dl>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
										</dl>
									</div>
									
									<div class="item">
										<h4 class="h4tit">
											<img src="images/site2.png" alt="">
											<span>集美污水处理厂（3/5）</span>
										</h4>
										<dl>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
											<dd>
												<a href="#">集美污水处理厂四期-后门</a>
											</dd>
										</dl>
									</div>

								</div>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>


<div class="alermodel" id="model1">
	<div class="shadow"></div>
	<div class="center">
		<dl>
			<dd>
				<a href="#">
					接入协议
				</a>
			</dd>
			<dd>
				<a href="#">
					添加监控点
				</a>
			</dd>
		</dl>
	</div>
</div>


<script src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/wow.min.js"></script>
<script type="text/javascript" src="js/global.js"></script>

<script type="text/javascript">
	// 步骤2：嵌入子页面的页面中在iframe的onload事件中向子页面抛以下消息
	var iframeWin = document.getElementById("iframe1");
	{
		iframeWin.onload = function(){
			iframeWin.contentWindow.postMessage({
				action:'sendTitle',   // 告诉子页面本页面的标题（action自行指定，但需要与子页面中监听的action保持一致
				msg: '将标题发给子页面',
				info: document.title
			}, '\*');
			iframeWin.contentWindow.postMessage({
				action:'updateInitParam',    // 告诉子页面一些初始值，包括浏览器视窗高度与宽度、iframe偏离文档的位置、iframe相对视窗的位置
				msg: '更新子页面一些初始值',
				showSize: {                       // 浏览器视窗高度与宽度
					width: $(window).width(),
					height: $(window).height()
				},
				iframeOffset: {                   // iframe偏离文档的位置
					left: iframeWin.offsetLeft,
					top: iframeWin.offsetTop
				},
				iframeClientPos: {	            // iframe相对视窗的位置
					left: iframeWin.getBoundingClientRect().left,
					right: iframeWin.getBoundingClientRect().right,
					top: iframeWin.getBoundingClientRect().top,
					bottom: iframeWin.getBoundingClientRect().bottom
				}
			}, '\*');   // '\*'表示跨域参数，请结合自身业务合理设置
		}
	}

	// 步骤3：监听嵌入子页面的事件
	window.addEventListener('message', function(e){
		console.log(e.data.msg);
		if(e && e.data){
			switch (e.data.action){
				case 'updateTitle':        // 本页面收到子页面通知更新标题通知，更新本页面标题
					document.title = e.data.info;
					break;
				case 'updatePos':
					var scrollLeftValue = document.documentElement.scrollLeft;
					var scrollTopValue = document.documentElement.scrollTop;
					iframeWin.contentWindow.postMessage({
						action:'updatePos',
						msg: '更新Pos',
						scrollValue: {          // 滚动条滚动的偏移量
							left: -1 * scrollLeftValue+277,
							top: -1 * scrollTopValue+174,
						}
					}, '\*');   // '\*'表示跨域参数，请结合自身业务合理设置
					break;
				default:
					break;
			}
		}
	});

	// 步骤4：兼听本页面的resize事件，并将一些状态值发送给嵌入的子页面
	var resizeTimer = null;
	var resizeDate;
	$(window).resize(function () {
		resizeDate = new Date();
		if (resizeTimer === null){
			resizeTimer = setTimeout(checkResizeEndTimer, 100);
		}
	});

	function checkResizeEndTimer(){
		if (new Date() - resizeDate > 100){  // resize结束后再发消息，避免残影问题
			clearTimeout(resizeTimer);
			resizeTimer = null;
			postResizeEvent();
		} else{
			setTimeout(checkResizeEndTimer, 100);
		}
	}

	function postResizeEvent(){
		iframeWin.contentWindow.postMessage({
			action: 'resize',
			msg: 'resize事件',
			showSize: {             // 告诉嵌入的子页面视窗高度与宽度
				width: $(window).width(),
				height: $(window).height()
			},
			iframeClientPos: {	    // iframe相对视窗的位置
				left: iframeWin.getBoundingClientRect().left,
				right: iframeWin.getBoundingClientRect().right,
				top: iframeWin.getBoundingClientRect().top,
				bottom: iframeWin.getBoundingClientRect().bottom
			},
			iframeOffset: {        // iframe偏离文档的位置
				left: iframeWin.offsetLeft,
				top: iframeWin.offsetTop
			}
		}, '\*');     // '\*'表示跨域参数，请结合自身业务合理设置
	}

	// 步骤5：兼听本页面的scroll事件，并将一些状态值发送给嵌入的子页面
	// 为性能考虑，可以在定时器中处理
	var scrollTimer = null;
	var scrollDate;
	$(window).scroll(function (event) {
		postScrollEvent();
		scrollDate = new Date();
		if (scrollTimer === null){
			scrollTimer = setTimeout(checkScrollEndTimer, 100);
		}
	});

	function checkScrollEndTimer(){
		if (new Date() - scrollDate > 100){  // resize结束后再发消息，避免残影问题
			clearTimeout(scrollTimer);
			scrollTimer = null;
		} else{
			postScrollEvent();
			setTimeout(checkScrollEndTimer, 100);
		}
	}

	function postScrollEvent(){
		// 计算滚动条偏移量
		var scrollLeftValue = document.documentElement.scrollLeft;
		var scrollTopValue = document.documentElement.scrollTop;
		iframeWin.contentWindow.postMessage({
			action:'scroll',
			msg: 'scroll事件',
			scrollValue: {          // 滚动条滚动的偏移量
				left: -1 * scrollLeftValue,
				top: -1 * scrollTopValue,
			},
			iframeClientPos: {	  // iframe相对视窗的位置
				left: iframeWin.getBoundingClientRect().left,
				right: iframeWin.getBoundingClientRect().right,
				top: iframeWin.getBoundingClientRect().top,
				bottom: iframeWin.getBoundingClientRect().bottom
			},
			showSize: {          // 告诉嵌入的子页面视窗高度与宽度
				width: $(window).width(),    // 视窗宽度
				height: $(window).height()  // 视窗高度
			},
			iframeOffset: {      // iframe偏离文档的位置
				left: iframeWin.offsetLeft,
				top: iframeWin.offsetTop
			}
		}, '\*');	   // '\*'表示跨域参数，请结合自身业务合理设置
	}

	/**
	 * 通知插件预览监控
	 * @param param 监控点编码
	 */
	function playBtn(param) {
		$.ajax({
			type: "post",
			data: {'code': param},
			url: "/showVedio",//访问controller路径
			success: function (json) {
				console.log(json)
				json = JSON.parse(json);
				if (json.code == '1') {
					// 执行预览
					iframeWin.contentWindow.postMessage({
						action:'showVedio',
						msg: '监控预览',
						info: json.data
					}, '\*');
				}
			}
		});
	}
</script>

</body>
</html>
